<div class="grid">
  <div class="column column-full">
    <h2>Stats</h2>
    <div class="row"><span>Users</span><span id="users"></span></div>
    <div class="row"><span>Workers</span><span id="workers"></span></div>
    <div class="row"><span>Connections</span><span id="connections"></span></div>
    <div class="row"><span>Hashrate (5m)</span><span id="hashrate_5m"></span></div>
    <div class="row"><span>SPS (5m)</span><span id="sps_5m"></span></div>
    <div class="row"><span>Uptime</span><span><span id="uptime_secs"></span>s</span></div>
    <div class="row"><span>Blocks</span><span id="blocks"></span></div>
    <h3>Shares</h3>
    <div class="row"><span>Accepted</span><span id="accepted"></span></div>
    <div class="row"><span>Rejected</span><span id="rejected"></span></div>
    <div class="row"><span>Best</span><span id="best_ever" class="copyable"></span></div>
    <div class="row"><span>Last</span><span><span id="last_share"></span>s ago</span></div>
  </div>

  <div class="column">
    <h2>Bitcoin</h2>
    <div class="row"><span>Block Height</span><span id="btc_height"></span></div>
    <div class="row"><span>Network Difficulty</span><span id="network_difficulty" class="copyable"></span></div>
  </div>

  <div class="column">
    <h2>System</h2>
    <div class="row"><span>CPU</span><span><span id="cpu_usage_percent"></span>%</span></div>
    <div class="row"><span>Memory</span><span><span id="memory_usage_percent"></span>%</span></div>
    <div class="row"><span>Disk</span><span><span id="disk_usage_percent"></span>%</span></div>
    <div class="row"><span>Uptime</span><span><span id="uptime"></span>s</span></div>
  </div>
</div>

<button id="log-show">Show Logs</button>
<div id="log-controls" class="hidden">
  <input type="search" id="log-filter" placeholder="Filter logs..." autocomplete="off" data-1p-ignore data-lpignore="true" data-bwignore="true">
  <button id="log-pause">Pause</button>
  <button id="log-clear">Clear</button>
  <button id="log-hide">Hide</button>
</div>
<div id="logs" class="hidden"></div>

<script>
async function refresh() {
  try {
    const [poolData, systemData, bitcoinData] = await Promise.all([
      fetch('/api/pool/status').then(r => r.json()).catch(() => ({})),
      fetch('/api/system/status').then(r => r.json()).catch(() => ({})),
      fetch('/api/bitcoin/status').then(r => r.json()).catch(() => ({}))
    ]);

    const network_difficulty = formatDifficulty(bitcoinData.network_difficulty);
    const best_ever = formatDifficulty(poolData.best_ever);

    // Pool data
    set('users', poolData.users);
    set('workers', poolData.workers);
    set('connections', poolData.connections);
    set('hashrate_5m', poolData.hashrate_5m, formatHashrate);
    set('sps_5m', poolData.sps_5m, formatTruncated);
    set('uptime_secs', poolData.uptime_secs);
    set('blocks', poolData.blocks);
    set('accepted', poolData.accepted);
    set('rejected', poolData.rejected);
    set('last_share', poolData.last_share);
    copyable('best_ever', best_ever, poolData.best_ever);

    // Bitcoin data
    set('btc_height', bitcoinData.height);
    copyable('network_difficulty', network_difficulty, bitcoinData.network_difficulty);

    // System data
    set('cpu_usage_percent', systemData.cpu_usage_percent, formatTruncated);
    set('memory_usage_percent', systemData.memory_usage_percent, formatTruncated);
    set('disk_usage_percent', systemData.disk_usage_percent, formatTruncated);
    set('uptime', systemData.uptime);
  } catch (e) { console.error('refresh error:', e); }
}
startPolling(refresh);
connectWs();
setupLogToggle();
initCopyables();
</script>
